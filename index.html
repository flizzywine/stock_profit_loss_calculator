<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密货币杠杆交易计算器</title>
    <style>
        /* --- 基础样式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- 计算器容器 --- */
        .calculator-container {
            background-color: #ffffff;
            padding: 25px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }

        h1 {
            text-align: center;
            color: #1a2b48;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.8em;
        }
        
        h2 {
            font-size: 1.2em;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        /* --- 表单组样式 --- */
        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .form-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input[type="number"]:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
            outline: none;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .radio-group label {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: 1px solid #ced4da;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }

        .radio-group input[type="radio"] {
            display: none;
        }

        .radio-group input[type="radio"]:checked + label {
            background-color: #007bff;
            color: #fff;
            border-color: #007bff;
            font-weight: bold;
        }

        /* --- 结果区域 --- */
        #results {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            padding: 12px 0;
        }
        
        .result-item:not(:last-child) {
            border-bottom: 1px solid #e9ecef;
        }

        .result-item .label {
            color: #555;
        }

        .result-item .value {
            font-weight: bold;
            font-size: 1.2em;
        }

        .position-value { color: #007bff; } /* 蓝色代表建议金额 */
        .sl-value { color: #dc3545; } /* 红色代表止损 */
        .tp-value { color: #28a745; } /* 绿色代表止盈 */

        .note {
            font-size: 0.85em;
            color: #888;
            text-align: center;
            margin-top: 15px;
            line-height: 1.5;
        }

    </style>
</head>
<body>

    <div class="calculator-container">
        <h1>交易计算器</h1>

        <!-- 基础设置 -->
        <div class="form-group">
            <div class="radio-group">
                <input type="radio" id="directionLong" name="direction" value="long" checked>
                <label for="directionLong">做多 (Long)</label>
                
                <input type="radio" id="directionShort" name="direction" value="short">
                <label for="directionShort">做空 (Short)</label>
            </div>
            <div class="radio-group">
                <input type="radio" id="assetBTC" name="asset" value="BTC" checked>
                <label for="assetBTC">BTC</label>

                <input type="radio" id="assetETH" name="asset" value="ETH">
                <label for="assetETH">ETH</label>
            </div>
        </div>

        <div class="form-group">
            <label for="entryPrice">入场价格 (USD)</label>
            <input type="number" id="entryPrice" placeholder="例如: 68000">
        </div>

        <!-- 止损设置 -->
        <h2>市价止损设置</h2>
        <div class="form-group">
            <label for="slAmount">愿意承担的最大亏损金额 (USD)</label>
            <input type="number" id="slAmount" value="4900">
        </div>
        <div class="form-group">
            <label for="slPercentage">可接受的止损百分比 (%)</label>
            <input type="number" id="slPercentage" step="0.1">
        </div>

        <!-- 止盈设置 -->
        <h2>跟踪单止盈设置</h2>
        <div class="form-group">
            <label for="tpActivationPercentage">期望获利百分比 (%)</label>
            <input type="number" id="tpActivationPercentage" step="0.1">
        </div>
        <div class="form-group">
            <label for="tpCallbackPercentage">回调百分比 (%)</label>
            <input type="number" id="tpCallbackPercentage" step="0.01">
        </div>

        <!-- 计算结果 -->
        <div id="results">
            <div class="result-item">
                <span class="label">建议投入金额</span>
                <span class="value position-value" id="positionSizeOutput">--</span>
            </div>
            <div class="result-item">
                <span class="label">止损价格</span>
                <span class="value sl-value" id="slPriceOutput">--</span>
            </div>
            <div class="result-item">
                <span class="label">止盈激活价格</span>
                <span class="value tp-value" id="tpActivationPriceOutput">--</span>
            </div>
    
        </div>
    </div>

    <script>
        // --- 1. 定义默认参数 ---
        const DEFAULTS = {
            BTC: {
                slPercentage: 4,
                tpActivationPercentage: 1.33,
                tpCallbackPercentage: 0.66,
            },
            ETH: {
                slPercentage: 6,
                tpActivationPercentage: 2.0,
                tpCallbackPercentage: 1.0,
            }
        };

        // --- 2. 获取所有需要操作的DOM元素 ---
        const inputs = {
            direction: document.querySelectorAll('input[name="direction"]'),
            asset: document.querySelectorAll('input[name="asset"]'),
            entryPrice: document.getElementById('entryPrice'),
            slAmount: document.getElementById('slAmount'),
            slPercentage: document.getElementById('slPercentage'),
            tpActivationPercentage: document.getElementById('tpActivationPercentage'),
            tpCallbackPercentage: document.getElementById('tpCallbackPercentage'),
        };

        const outputs = {
            positionSize: document.getElementById('positionSizeOutput'),
            slPrice: document.getElementById('slPriceOutput'),
            tpActivationPrice: document.getElementById('tpActivationPriceOutput'),
            entryPriceRef: document.getElementById('entryPriceRef'),
            slAmountRef: document.getElementById('slAmountRef'),
            slPercentageFromAmount: document.getElementById('slPercentageFromAmount'),
        };

        // --- 3. 核心计算函数 ---
        function calculate() {
            // 获取当前输入值
            const direction = document.querySelector('input[name="direction"]:checked').value;
            const entryPrice = parseFloat(inputs.entryPrice.value);
            const slAmount = parseFloat(inputs.slAmount.value);
            const slPercentage = parseFloat(inputs.slPercentage.value);
            const tpActivationPercentage = parseFloat(inputs.tpActivationPercentage.value);

            // 清理函数：如果主要输入无效，则清空所有结果
            const clearResults = () => {
                outputs.positionSize.textContent = '--';
                outputs.slPrice.textContent = '--';
                outputs.tpActivationPrice.textContent = '--';
                outputs.slPercentageFromAmount.textContent = '--';
                outputs.entryPriceRef.textContent = '--';
            };

            // --- 计算建议投入金额 (仓位大小) ---
            // 公式: 仓位大小 = 愿意亏损的金额 / 止损百分比
            let positionSize = NaN;
            if (!isNaN(slAmount) && !isNaN(slPercentage) && slPercentage > 0) {
                positionSize = slAmount / (slPercentage / 100);
                outputs.positionSize.textContent = '$ ' + positionSize.toFixed(2);
            } else {
                outputs.positionSize.textContent = '--';
            }

            // 输入验证：如果入场价无效，则只计算仓位大小，其他清空
            if (isNaN(entryPrice) || entryPrice <= 0) {
                clearResults();
                // 重新计算并显示仓位大小，因为它不依赖于入场价
                if (!isNaN(positionSize)) {
                    outputs.positionSize.textContent = '$ ' + positionSize.toFixed(2);
                }
                return;
            }

            let slPrice, tpActivationPrice;

            // 根据做多/做空计算
            if (direction === 'long') {
                // 止损价格 = 入场价 * (1 - 止损百分比)
                slPrice = entryPrice * (1 - slPercentage / 100);
                // 激活价格 = 入场价 * (1 + 期望获利百分比)
                tpActivationPrice = entryPrice * (1 + tpActivationPercentage / 100);
            } else { // short
                // 止损价格 = 入场价 * (1 + 止损百分比)
                slPrice = entryPrice * (1 + slPercentage / 100);
                // 激活价格 = 入场价 * (1 - 期望获利百分比)
                tpActivationPrice = entryPrice * (1 - tpActivationPercentage / 100);
            }

            // 根据止损金额反算百分比
            const slPercentageFromAmount = (slAmount / entryPrice) * 100;

            // 更新显示结果，保留合理的小数位数
            outputs.slPrice.textContent = slPrice.toFixed(2);
            outputs.tpActivationPrice.textContent = tpActivationPrice.toFixed(2);
            
            // 更新底部提示信息
            outputs.entryPriceRef.textContent = entryPrice;
            outputs.slAmountRef.textContent = slAmount.toFixed(2);
            outputs.slPercentageFromAmount.textContent = slPercentageFromAmount.toFixed(2);
        }

        // --- 4. 更新默认值的函数 ---
        function updateDefaults() {
            const selectedAsset = document.querySelector('input[name="asset"]:checked').value;
            const defaults = DEFAULTS[selectedAsset];

            inputs.slPercentage.value = defaults.slPercentage;
            inputs.tpActivationPercentage.value = defaults.tpActivationPercentage;
            inputs.tpCallbackPercentage.value = defaults.tpCallbackPercentage;
            
            // 更新默认值后立即重新计算
            calculate();
        }

        // --- 5. 绑定事件监听器 ---
        
        // 监听所有输入框和单选按钮的变化
        document.querySelector('.calculator-container').addEventListener('input', calculate);
        document.querySelector('.calculator-container').addEventListener('change', calculate);

        // 特别监听资产切换事件，以更新默认值
        inputs.asset.forEach(radio => {
            radio.addEventListener('change', updateDefaults);
        });
        
        // --- 6. 页面加载时初始化 ---
        window.addEventListener('DOMContentLoaded', () => {
            updateDefaults(); // 页面加载时，根据默认选中的资产（BTC）设置默认值
        });

    </script>
</body>
</html>
